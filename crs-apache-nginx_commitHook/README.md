# repository_server_1c - Контейнер с 1С сервером хранилища 8.3

- Создаем файловое хранилище для 1С конфигурации с доступом по tcp на порт 1542
- Поместить полученное хранилище на httpd сервер Апача
  - Зарегистрировать модуль расширения веб-сервера;
  - `httpd-foreground` Запуск Апача (если необходимо зайти в контейнер) `docker exec -it onec-crs bash`

## Для сборки и запуска контейнера

1. У вас есть развернутое внутреннее хранилище дистрибутивов с доступом по http ([как развернуть на Nginx](./static/README.md) )
2. Склонировать текущий репозиторий и перейти в директорию `crs-apache-nginx_commitHook`
3. Создать директорию с доступом на запись `stor` для 1С-хранилищ (будет смонтирована в контейнер)
4. Запустить сборку и развертывание докер-контейнера через `docker-compose up`

## TODO

...

### Для веб-сервера Apache

Для того чтобы выполнить настройку веб-сервера Apache на работу с хранилищем конфигурации, необходимо выполнить следующие действия:

- Включить в конфигурационный файл веб-сервера (`httpd.conf`) загрузку модуля расширения веб-сервера. В зависимости от версии веб-сервера и используемой операционной системы, модули расширения имеют разное имя:

● Для ОС Linux:

● Для Apache 2.0: wsapch2.so.

● Для Apache 2.2: wsap22.so.

● Для Apache 2.4: wsap24.so.

Модуль расширения веб-сервера имеет идентификатор `_1cws_module`. Для загрузки модуля необходимо внести в конфигурационный файл следующую строку вида `LoadModule _1cws_module <путь к модулю расширения веб-сервера>`.

Пример для ОС Linux:

```
LoadModule _1cws_module /opt/1C/v8.2/i386/wsap22.so
```

● Создать на веб-сервере виртуальный каталог, через который будет осуществляться доступ к хранилищу конфигурации и зарегистрировать обработчик файлов для каталога виртуального приложения. Идентификатор регистрируемого обработчика: 1c-application.

```
Пример виртуального каталога для ОС Linux:

Копировать в буфер обмена
Alias "/repos" "/var/1C/www/repos"
<Directory "/var/1C/www/repos">
    AllowOverride None
    Options None
    Order allow,deny
    Allow from all
    SetHandler 1c-application
</Directory>
```

● Разместить в папке с файлами виртуального каталога файл `*.1ccr`, в котором указать адрес сервера хранилища конфигурации (в схеме TCP).

Пример файла `.1ccr`:

```
<?xml version="1.0" encoding="UTF-8"?>
<repository connectString="tcp://192.168.60.31"/>
```

● Перезапустить веб-сервер.

- Зарегистрировать виртуальное приложение на веб-сервере;
- Опубликовать конфигурационный файл работы с сервером хранилища конфигурации.

- Строка подключения пример http://адресВЕБхранилища/ПутьАлиаса/имяфайла.1ccr/имяСтрокиСоединенияСХранилищем

## Полезные ресурсы:

https://github.com/SergeFocus/onec-docker

https://github.com/asosnoviy/commitHook

https://github.com/esboych/docker-nginx-lua

https://github.com/aglotov/1c-server-repo

https://github.com/asdaru/repository_server_1c

# Лицензия

http://www.apache.org/licenses/LICENSE-2.0

APACHE LICENSE-2.0 ... Другими словами, пожалуйста, используйте свободно и делайте с ним все, что хотите!
